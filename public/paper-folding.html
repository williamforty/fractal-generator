<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fractal Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
  <style>
    body {
      background-color: #333;
    }
  </style>
</head>
  <body>
    <script>

      // Recursive function for unfolding the paper
      function unfold(points, times) {

        // Escape
        if (times <= 0) return;

        // Get the last point, to use as an origin for rotation
        const originX = points[points.length - 2];
        const originY = points[points.length - 1];
        
        for (let i = points.length - 3; i > 0; i -= 2) {
          // Get the relative position of x and y
          let dX = points[i - 1] - originX;
          let dY = points[i] - originY;
          // Calculate the new position
          // -4,-3 => +3,-4 => +4,+3 => -3,+4
          let newX = -dY;
          let newY = dX;
          points.push(newX + originX);
          points.push(newY + originY);
        }

        unfold(points, times - 1);

      }

      // Create a Pixi Application
      const app = new PIXI.Application({width: 1200, height: 800})

      // Add the canvas that Pixi automatically created for you to the HTML document
      document.body.appendChild(app.view)

      // Create the points for the folded paper
      const points = [
        450, 250,
        453, 250,
      ]

      // Unfold the paper
      unfold(points, 15);

      // Add the line
      const gfx = new PIXI.Graphics()
      gfx.lineStyle(1, 0x00cc00, 1)
      gfx.moveTo(points[0], points[1])
      for (let i = 2; i < points.length; i += 2) {
        gfx.lineTo(points[i], points[i+1])
      }
      app.stage.addChild(gfx)

    </script>
  </body>
</html>
